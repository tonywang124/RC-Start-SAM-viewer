<!DOCTYPE html>

<html lang="en">
	<head>
		<meta charset="utf-8"> <!-- Required for d3 to parse data and functions. -->
		<title>SAM Viewer</title>
		<script type="text/javascript" src = "d3/d3.js"></script>
		<link rel="stylesheet" type="text/css" href="styles.css">
	</head>
	<body>
    <script type="text/javascript">
        // Hard coded sample data
        var read1 = {name: "r1", flag: 4, pos: 15, mapq: 30, seq: "GCCTAAGCTAA"};
        var read2 = {name: "r2", flag: 2, pos: 30, mapq: 10, seq: "GCCTAGACGATA"};
        var read3 = {name: "r3", flag: 8, pos: 60, mapq: 45, seq: "GCCTAAGCTAAAGTCTAAAAA"};
        var read4 = {name: "r4", flag: 4, pos: 100, mapq: 60, seq: "GCCTAAGCTAAGAGAAAATCAGA"};
        var read5 = {name: "r5", flag: 4, pos: 120, mapq: 90, seq: "GCCTAA"};
        var sampleData = [read1 , read2, read3, read4, read5];

        // Getters for working with read data structure.
        var getPos = function(d) {
          return d.pos;
        }
        var getLength = function(d) {
          sequence = d.seq;
          return sequence.length;
        }
				var getExtent = function(d) {
					return d.pos + d.seq.length
				}

        //Initial setup of SVG canvas.
        var margin = {top: 20, bottom: 30, left: 30, right: 30};
        var barPadding = 1;
        var height = 1000 - margin.top - margin.bottom;
        var width = 1000 - margin.left - margin.right;
        var canvas = d3.select("body")
                       .append("svg")
                       .attr({
                       	    "height": height + margin.top + margin.bottom,
                       	    "width": width + margin.left + margin.right
                       })
                       .append("g")
                       .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        //Set up scales
        var xScale = d3.scale.linear()
                             .domain([0, d3.max(sampleData, function(d) {return getExtent(d);})])
                             .range([0, width]);

        var yScale = d3.scale.ordinal()
                       .domain(d3.range(sampleData.length))
                       .rangeRoundBands([0, height], 0.05);

        //Set up axis. Only have xAxis representing position of reads.
        var xAxis = d3.svg.axis()
                      .scale(xScale)
                      .orient("bottom")
                      // .tickSize(-height, 0)
                      .ticks(7);
                      // .tickPadding(6);

        //Bind data to rects and initialize view.
        canvas.selectAll("rect.reads")
              .data(sampleData)
              .enter()
              .append("rect")
              .attr({
              	x: function(d) {
              		return xScale(getPos(d));
              	},
              	y: function(d,i) {
                  return yScale(i);
              	},
                height: height / sampleData.length - barPadding,
                width: function(d, i) {
                  return xScale(getLength(d));
                },
                fill: function(d) {
                  return "rgb(0,0, " + (d.mapq) + ")";
                },
                class: "reads"
                });

        //Add axis to canvas
        canvas.append("g")
              .attr("class", "axis")
              .attr("transform", "translate(" + margin.left + "," + (height - margin.bottom) + ")")
              .call(xAxis);


        var zoom = d3.behavior.zoom()
                     .scaleExtent([0.1, 10])
                     .x(xScale)
                     .on("zoom", zoomed);

        //callback function for zooming.
        function zoomed() {
          canvas.select("g.axis").call(xAxis);
              canvas.selectAll("rect.reads")
                    .attr({
                      x: function(d) {
                        return xScale(getPos(d));
                      },
                      y: function(d, i) {
                        return yScale(i);
                      },
                      height: height / sampleData.length - barPadding,
                      width: function(d, i) {
												// return xScale(getLength(d));
                        return xScale(getExtent(d)) - xScale(getLength(d));
                      }
                    });
        }
        //Added rectangle spanning entire SVG for zooming.
        canvas.append("rect")
              .attr("class", "pane")
              .attr("width", width)
              .attr("height", height)
              .call(zoom);


    </script>
	</body>
</html>


<!-- 		<button id="add">Add Random Element</button>
		<button id="remove">Remove Element</button>
		<div id="tooltip" class="hidden">
	        <p><strong>Important Label Heading</strong></p>
	        <p><span id="value">100</span>%</p>
        </div>
		<script type="text/javascript">
		</script> -->
